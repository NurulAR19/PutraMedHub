<html>
    <body>

    Image Name

    <input id="namebox" type="text"/> <br><br>
    <img id="myimg" style="width: 100px; height: 100px; border: 2px;"/>

    <label id="UpProgress"></label><br><br>
  
    <button id="select">Select Image</button>
    <button id="upload">Upload Image</button>
    <button id="retrieve">Retrieve Image</button>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>


<script id="MainScript">
//-----------------VARIABLES---------------------//
    var ImgName,ImgUrl;
    var reader = new FileReader();

//-----------------CONFIGURATION---------------------//
    // Initialize Firebase
    var firebaseConfig = {
        apiKey: "AIzaSyCnUzaGSSNBlhiIMrM3VreZkyCYd3WCNf8",
        authDomain: "putramedhub.firebaseapp.com",
        databaseURL: "https://putramedhub-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "putramedhub",
        storageBucket: "putramedhub.appspot.com",
        messagingSenderId: "830640634563",
        appId: "1:830640634563:web:c6db3966d084083320c076",
        measurementId: "G-VLV6R6B080"
        };
            
        firebase.initializeApp(firebaseConfig);

    // Get a reference to the database service
    var database = firebase.database();


//-----------------SELECT IMAGE---------------------//

document.getElementById("select").onclick = function(e){
    
    var input = document.createElement('input');
    input.type = 'file';
    

    input.onchange = e => {
        files = e.target.files;
        reader = new FileReader();
        reader.onload = function(){
            document.getElementById("myimg").innerHTML = reader.result;
        }
        reader.readAsDataURL(files[0]);
    }
    input.click();
}

//-----------------UPLOAD IMAGE---------------------//

//-----------------upload image to storage---------------------//

document.getElementById("upload").onclick = function(e){
    
    ImgName = document.getElementById('namebox').value;
    var uploadTask = firebase.storage().ref('Images/'+ ImgName).put(files[0]);

    uploadTask.on('state_changed', function(snapshot){
        var progress = (snapshot.bytesTransferred / snapshot.totalBytes)*100;
        document.getElementById('UpProgress').innerHTML = 'Upload ' + progress + '%';
    },

//-----------------error handling--------------------//
    function(error){
        alert('error in saving the image');
    },

//-----------------submit image link to realtime database--------------------//
    function(){
        uploadTask.snapshot.ref.getDownloadURL().then(function(url){
            ImgUrl = url;
        
            firebase.database().ref('Pictures/'+ImgName).set({
                Name: ImgName,
                Link: ImgUrl
            });
        alert('file successfully added');
        });
    
    });
}

//-----------------RETRIEVE IMAGE---------------------//
document.getElementById("retrieve").onclick = function(e){
    ImgName = document.getElementById('namebox').value;
    firebase.database().ref('Pictures/'+ImgName).on('value', function(snapshot){
        document.getElementById('myimg').src = snapshot.val().Link;
    });

}
</script>





</body>
</html>